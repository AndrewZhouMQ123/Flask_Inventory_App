{% extends "base.html" %}
{% block title %}Peoples Page{% endblock %}

{% block content %}
    {% include 'content.html' %}
    <h1>Peoples</h1>
    <script src="/js/hello.js"></script>

    {% if current_user.role == 'admin' %}
        <ul>
            {% for person in people %}
                <li>{{ person }} <button onclick="deletePerson('{{ person.pid }}')">Delete</button>
                <a href="{{ url_for('peoples.details', pid=person.pid) }}">Details</a></li>
            {% endfor %}
        </ul>

        <h3>New Person</h3>
        <form action="{{ url_for('peoples.people') }}" method="POST">
            <input type="text" name="name" placeholder="Name" required="required"><br>
            <input type="number" name="age" placeholder="Age"><br>
            <input type="text" name="job" placeholder="Job"><br>
            <input type="submit" value="Create">
        </form>
    
    {% else %}
        <ul>
            {% for person in people %}
                <li>{{ person }}
                <a href="{{ url_for('peoples.details', pid=person.pid) }}">Details</a></li>
            {% endfor %}
        </ul>
    {% endif %}

        <script type="text/javascript">
            function deletePerson(pid) {
                fetch('{{ url_for("peoples.delete", pid=pid) }}' + pid, {
                    method: 'DELETE'
                }).then(response => {
                    if (response.ok) {
                        window.location.reload();
                    } else {
                        console.error('Failed to delete item with pid:', pid)
                    }
                }).catch(error => {
                    console.error('Error during fetching:', error)
                });
            }
        </script>
{% endblock %}